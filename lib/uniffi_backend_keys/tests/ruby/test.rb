require "test/unit"
require "backend_keys"
 
class TestApk < Test::Unit::TestCase
  @@seed = (1..32).to_a

	@@network = BackendKeys::Network::MAIN
 
	@@zusk = BackendKeys::ZcashUnifiedSpendingKey.new(
		@transparent=BackendKeys::ZcashAccountPrivKey.new([92, -6, -81, 77, 90, 67, -96, 51, 80, -84, -58, -41, -31, 26, -56, 85, 75, -35, 126, 85, 70, -39, 7, 14, 33, 91, -94, 40, 0, 118, -49, -120, -67, 22, -68, 25, 102, -58, 36, 40, 69, 81, 23, 9, 58, -52, -113, -29, 80, 31, -75, 2, 116, -111, 106, 21, 80, -58, 40, -10, 119, 26, 102, 63]), 
		@sapling=BackendKeys::ZcashExtendedSpendingKey.new([3, 23, -96, -95, 0, 0, 0, 0, -128, -7, -57, -103, 117, -64, 64, -73, 56, -40, 60, 40, 89, -40, -71, 14, 28, -32, -52, 24, 99, -35, -58, -37, 14, 119, -6, -5, -104, 120, 97, 123, 14, 29, 96, 111, 107, -43, 57, 90, 46, -44, 54, -34, -59, -51, 79, 80, 58, -36, -128, 56, 61, 35, 88, 124, 68, 120, -100, 64, -74, 61, -2, 73, 7, -119, 55, 88, -103, -110, 14, -93, 60, 127, 38, 37, -78, 104, -57, -50, 104, 118, -85, -70, -86, 116, 36, 25, -7, -95, 112, -88, -95, -8, 14, -30, 10, 63, 7, 73, 101, 60, -107, 50, 114, 58, -84, -52, 34, -19, 69, 57, 34, 2, 57, -49, -83, -31, -52, -70, 117, 102, 9, -105, -118, 97, 6, 33, -101, 124, -95, 25, 123, -43, -69, 48, -94, 33, -68, 58, -126, -47, 68, -106, 80, 18, -66, -89, -117, 118, 24, 70, 75, 99, 25, -97, 22, 79, 28, 82, 84]), 
		@orchard=BackendKeys::ZcashSpendingKey.new([50, -25, -77, 64, -99, 91, -69, 116, -75, 99, 7, 44, 93, -18, 22, 15, 62, -73, 104, -49, -47, 68, 68, -108, -39, 24, 98, -102, 62, -114, 112, -5]), 
		@binary=[-76, -48, -42, -62, 3, 32, 50, -25, -77, 64, -99, 91, -69, 116, -75, 99, 7, 44, 93, -18, 22, 15, 62, -73, 104, -49, -47, 68, 68, -108, -39, 24, 98, -102, 62, -114, 112, -5, 2, -87, 3, 23, -96, -95, 0, 0, 0, 0, -128, -7, -57, -103, 117, -64, 64, -73, 56, -40, 60, 40, 89, -40, -71, 14, 28, -32, -52, 24, 99, -35, -58, -37, 14, 119, -6, -5, -104, 120, 97, 123, 14, 29, 96, 111, 107, -43, 57, 90, 46, -44, 54, -34, -59, -51, 79, 80, 58, -36, -128, 56, 61, 35, 88, 124, 68, 120, -100, 64, -74, 61, -2, 73, 7, -119, 55, 88, -103, -110, 14, -93, 60, 127, 38, 37, -78, 104, -57, -50, 104, 118, -85, -70, -86, 116, 36, 25, -7, -95, 112, -88, -95, -8, 14, -30, 10, 63, 7, 73, 101, 60, -107, 50, 114, 58, -84, -52, 34, -19, 69, 57, 34, 2, 57, -49, -83, -31, -52, -70, 117, 102, 9, -105, -118, 97, 6, 33, -101, 124, -95, 25, 123, -43, -69, 48, -94, 33, -68, 58, -126, -47, 68, -106, 80, 18, -66, -89, -117, 118, 24, 70, 75, 99, 25, -97, 22, 79, 28, 82, 84, 0, 64, 92, -6, -81, 77, 90, 67, -96, 51, 80, -84, -58, -41, -31, 26, -56, 85, 75, -35, 126, 85, 70, -39, 7, 14, 33, 91, -94, 40, 0, 118, -49, -120, -67, 22, -68, 25, 102, -58, 36, 40, 69, 81, 23, 9, 58, -52, -113, -29, 80, 31, -75, 2, 116, -111, 106, 21, 80, -58, 40, -10, 119, 26, 102, 63],
    @network=BackendKeys::Network::MAIN
  )

  @@ufvk = BackendKeys::ZcashUnifiedFullViewingKey.new(
  	@transparent=BackendKeys::ZcashAccountPubKey.new([-67, 22, -68, 25, 102, -58, 36, 40, 69, 81, 23, 9, 58, -52, -113, -29, 80, 31, -75, 2, 116, -111, 106, 21, 80, -58, 40, -10, 119, 26, 102, 63, 3, 116, -99, -70, 3, -100, -60, -15, -25, -68, -124, -25, -5, -73, -59, 120, -114, 7, -84, 114, -26, 107, -40, -11, 50, 39, -87, 97, 26, 96, -88, 99, -119]), 
  	@sapling=BackendKeys::ZcashDiversifiableFullViewingKey.new([92, 16, 9, -62, -81, -69, 33, -45, -55, -30, 89, 15, 74, 66, 101, -62, -78, 9, -117, -50, -128, 89, -97, 33, -6, -100, 83, -4, -30, 10, -96, -51, -90, 114, -76, 30, 88, -70, -119, -18, 30, -85, 62, -68, 45, 61, -109, 87, -82, -61, -60, 76, 61, -45, -28, -92, 25, 8, 17, -98, 12, -39, 54, -81, 63, 7, 73, 101, 60, -107, 50, 114, 58, -84, -52, 34, -19, 69, 57, 34, 2, 57, -49, -83, -31, -52, -70, 117, 102, 9, -105, -118, 97, 6, 33, -101, 124, -95, 25, 123, -43, -69, 48, -94, 33, -68, 58, -126, -47, 68, -106, 80, 18, -66, -89, -117, 118, 24, 70, 75, 99, 25, -97, 22, 79, 28, 82, 84]), 
  	@orchard=BackendKeys::ZcashFullViewingKey.new([55, 9, 55, -63, 67, 48, -125, 125, -106, 96, -73, -102, 107, 106, 95, 48, -102, 87, -76, 85, -18, -74, 112, 86, 3, -78, 1, -125, 7, 37, 111, 51, -44, -72, 16, -63, -84, 21, 99, 25, -16, 119, -57, -15, -33, -43, -53, 1, 69, -74, -4, -91, -91, 3, 102, -112, 121, 58, -98, -99, 60, -3, 106, 58, -16, 39, 122, -88, 34, -127, -30, -68, 59, -99, -125, -35, -42, -46, 23, 102, 5, 69, 58, 30, 70, -101, -124, -104, -66, 68, -111, 36, -46, 41, -117, 43]), 
  	@encoded="uview1an4n3ycwfdxukarppvw6esd3vjwh6ee02sdv228dpkrgz7qnjfuvelfzjsfdg2xtmanv9es2s25k0afzs7rxhdt7eh79y2kn68rhjuqj0h3y4z8yku96xmucuy3u48qkth0djjr5ufe4p26y65fqckqlzfkdwltprj3zth5a0qqgl6x0qxhe5h48el50n00zkw0sve8c6u9zcghgqq2006xu4r4dfzqj74gz2meu9advysxffyw23q7yf63czhg0hzh9xtchlhfc53suycj8h9x0ts2n74xx0acs503uyq04u0d6qus2ajfg3t33u6pqcc659lyyydwtvtewee6xf9sapcvjccnqu2ep5mhkd3k4hgtr0d8hpx74rj9eshl0hw2g99gaj8fuq0y5xfy99pamvgy7npmx8hwtxfp2w8rayx4r633lkt3wcrsnl4f4qusmqr299eepkatw3qdkmp4arue3jzkdzwxvd85cf3k7g8860vwyr0la"
  )

  def test_unified_sk_from_seed
    zusk = BackendKeys.unified_sk_from_seed(@@network, @@seed, 0)

    assert_equal(zusk,  @@zusk)
  end

  def test_unified_fvk_from_usk
  	ufvk = BackendKeys.unified_fvk_from_usk(@@zusk)

    assert_equal(ufvk,  @@ufvk)
  end

  def test_deserialize_ufvk
  	ufvk = BackendKeys.deserialize_ufvk(@@ufvk.encoded, @@network)

    assert_equal(ufvk,  @@ufvk)
  end

  def test_from_bytes
    arr_bytes = (1..32).to_a
    zapk = BackendKeys::ZcashAccountPrivKey.new(arr_bytes)
    assert_equal(zapk, BackendKeys.from_bytes(arr_bytes))
  end

  def test_from_seed
    arr_bytes = (1..32).to_a
    from_seed_above = [92,-6,-81,77,90,67,-96,51,80,-84,-58,-41,-31,26,-56,85,75,-35,126,85,70,-39,7,14,33,91,-94,40,0,118,-49,-120,-67,22,-68,25,102,-58,36,40,69,81,23,9,58,-52,-113,-29,80,31,-75,2,116,-111,106,21,80,-58,40,-10,119,26,102,63]
    zapk = BackendKeys::ZcashAccountPrivKey.new(from_seed_above)
    assert_equal(zapk, BackendKeys.from_seed(arr_bytes, 0))
  end
end